{{template "header" .}}
<div id="diagram_panel"></div>
<script language="javascript">
	(function($) {

		function getUrlVars() {
			var vars = [],
				hash;
			var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			for (var i = 0; i < hashes.length; i++) {
				hash = hashes[i].split('=');
				vars.push(hash[0]);
				vars[hash[0]] = hash[1];
			}
			return vars;
		}

		const API_PREFIX = 'http://{{ .env.ENDPOINT }}/v1';
		var diagramType = getUrlVars()["diagram_type"]

		function onUpdateNetworkDiagram() {
			$("#diagram_panel").children().remove();
			$("#diagram_panel").append('<div id="diagram"></div>');

			var distance = null;
			if (diagramType == "physical") {
				distance = function(force) {
					force.jaccardLinkLengths(70, 0.2);
				}
			}
			else {
				distance = function(force) {
					force.jaccardLinkLengths(150, 0.2);
				}
			}
			var diagramInstance = new Diagram('#diagram', API_PREFIX + '/diagrams/' + diagramType, {
				pop: /^([^\s-]+)-/,
				distance: distance,
				width: 1200,
				height: 900
			});
			diagramInstance.init('interface');
		}

		function onLoad() {
			onUpdateNetworkDiagram();
		}

		onLoad();

	})(jQuery);
</script>
{{template "footer" .}}
